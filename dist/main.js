(()=>{"use strict";var t=function(){function t(t,e,n,o){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=n?n:0,this.w=null!=o?o:1,this.normalize()}return t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t>0&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t)},t.prototype.conjugate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w},t.prototype.rotate=function(e,n,o){var i=Math.cos(n/2),r=Math.sin(n/2),a=Math.cos(o/2),s=Math.sin(o/2),c=Math.cos(e/2),u=Math.sin(e/2),l=i*a,h=r*s,f=new t(l*u+h*c,r*a*c+i*s*u,i*s*c-r*a*u,l*c-h*u);this.multiply(f)},t.prototype.multiply=function(t){var e=t.x*this.w+t.y*this.z-t.z*this.y+t.w*this.x,n=-t.x*this.z+t.y*this.w+t.z*this.x+t.w*this.y,o=t.x*this.y-t.y*this.x+t.z*this.w+t.w*this.z,i=-t.x*this.x-t.y*this.y-t.z*this.z+t.w*this.w;this.x=e,this.y=n,this.z=o,this.w=i},t.prototype.toMatrix4=function(){this.normalize();var t=this.w*this.w,e=this.x*this.x,n=this.y*this.y,o=this.z*this.z,i=e-n-o+t,r=-e+n-o+t,a=-e-n+o+t,s=this.x*this.y,c=this.z*this.w,l=2*(s+c),h=2*(s-c),f=2*((s=this.x*this.z)-(c=this.y*this.w)),m=2*(s+c);return s=this.y*this.z,c=this.x*this.w,new u(i,l,f,0,h,r,2*(s+c),0,m,2*(s-c),a,0,0,0,0,1)},t.fromMatrix4=function(e){var n,o,i,r,a=e.getElementAt(0,0)+e.getElementAt(1,1)+e.getElementAt(2,2);if(a>0){var s=2*Math.sqrt(a+1);n=(e.getElementAt(2,1)-e.getElementAt(1,2))/s,o=(e.getElementAt(0,2)-e.getElementAt(2,0))/s,i=(e.getElementAt(1,0)-e.getElementAt(0,1))/s,r=s/4}else if(e.getElementAt(0,0)>e.getElementAt(1,1)&&e.getElementAt(0,0)>e.getElementAt(2,2)){var c=2*Math.sqrt(1+e.getElementAt(0,0)-e.getElementAt(1,1)-e.getElementAt(2,2));n=c/4,o=(e.getElementAt(0,1)+e.getElementAt(1,0))/c,i=(e.getElementAt(0,2)+e.getElementAt(2,0))/c,r=(e.getElementAt(2,1)-e.getElementAt(1,2))/c}else if(e.getElementAt(1,1)>e.getElementAt(2,2)){var u=2*Math.sqrt(1+e.getElementAt(1,1)-e.getElementAt(0,0)-e.getElementAt(2,2));n=(e.getElementAt(0,1)+e.getElementAt(1,0))/u,o=u/4,i=(e.getElementAt(1,2)+e.getElementAt(2,1))/u,r=(e.getElementAt(0,2)-e.getElementAt(2,0))/u}else{var l=2*Math.sqrt(1+e.getElementAt(2,2)-e.getElementAt(0,0)-e.getElementAt(1,1));n=(e.getElementAt(0,2)+e.getElementAt(2,0))/l,o=(e.getElementAt(1,2)+e.getElementAt(2,1))/l,i=l/4,r=(e.getElementAt(1,0)-e.getElementAt(0,1))/l}return new t(n,o,i,r)},t.interpolate=function(e,n,o){var i=new t,r=e.x*n.x+e.y*n.y+e.z*n.z+e.w*n.w;if(Math.abs(r)>=1)return i.w=e.w,i.x=e.x,i.y=e.y,i.z=e.z,i;var a=Math.acos(r),s=Math.sqrt(1-r*r);if(Math.abs(s)<1e-5)return i.w=.5*e.w+.5*i.w,i.x=.5*e.x+.5*i.x,i.y=.5*e.y+.5*i.y,i.z=.5*e.z+.5*i.z,i;var c=Math.sin((1-o)*a)/s,u=Math.sin(o*a)/s;return i.w=e.w*c+n.w*u,i.x=e.x*c+n.x*u,i.y=e.y*c+n.y*u,i.z=e.z*c+n.z*u,i},t}();function e(t){return t*Math.PI/180}function n(t,e,n){return(1-n)*t+n*e}var o,i,r,a=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t){function e(e,n,o){var i=t.call(this,null!=e?e:0,null!=n?n:0)||this;return i.z=null!=o?o:0,i}return a(e,t),e.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},e.normalize=function(t){var n=e.magnitude(t);return n>0?e.divide(t,n):new e(0,0,0)},e.add=function(t,n){return new e(t.x+n.x,t.y+n.y,t.z+n.z)},e.subtract=function(t,n){return new e(t.x-n.x,t.y-n.y,t.z-n.z)},e.multiply=function(t,n){return new e(t.x*n,t.y*n,t.z*n)},e.divide=function(t,n){return 0!==n?new e(t.x/n,t.y/n,t.z/n):(console.error("Can't divide by zero, Vector3 was not divided!"),t)},e.dotProduct=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.vectorCrossProduct=function(t,n){return new e(t.y*n.z-t.z*n.y,t.z*n.x-t.x*n.z,t.x*n.y-t.y*n.x)},e.interpolate=function(t,o,i){return new e(n(t.x,o.x,i),n(t.y,o.y,i),n(t.z,o.z,i))},e.zero=new e(0,0,0),e.forward=new e(0,0,-1),e.backward=new e(0,0,1),e.up=new e(0,1,0),e.down=new e(0,-1,0),e.left=new e(-1,0,0),e.right=new e(1,0,0),e}(function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.normalize=function(e){var n=t.magnitude(e);return n>0?t.divide(e,n):new t(0,0)},t.add=function(e,n){return new t(e.x+n.x,e.y+n.y)},t.subtract=function(e,n){return new t(e.x-n.x,e.y-n.y)},t.multiply=function(e,n){return new t(e.x*n,e.y*n)},t.divide=function(e,n){return 0!==n?new t(e.x/n,e.y/n):(console.error("Can't divide by zero, Vector2 was not divided!"),e)},t.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},t}()),c=function(t){function e(e,n,o,i){var r=t.call(this,null!=e?e:0,null!=n?n:0,null!=o?o:0)||this;return r.w=null!=i?i:1,r}return a(e,t),e.forward=new e(0,0,-1,1),e.backward=new e(0,0,1,1),e.up=new e(0,1,0,1),e.down=new e(0,-1,0,1),e.left=new e(-1,0,0,1),e.right=new e(1,0,0,1),e}(s),u=function(){function e(t,e,n,o,i,r,a,s,c,u,l,h,f,m,x,p){this.elements=[null!=t?t:0,null!=e?e:0,null!=n?n:0,null!=o?o:0,null!=i?i:0,null!=r?r:0,null!=a?a:0,null!=s?s:0,null!=c?c:0,null!=u?u:0,null!=l?l:0,null!=h?h:0,null!=f?f:0,null!=m?m:0,null!=x?x:0,null!=p?p:0]}return e.prototype.getElementAt=function(t,e){return this.elements[4*e+t]},e.prototype.setElementAt=function(t,e,n){this.elements[4*e+t]=n},e.prototype.flatten=function(){return this.elements},e.makeIdentity=function(){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},e.makeScale=function(t,n,o){return new e(t,0,0,0,0,n,0,0,0,0,o,0,0,0,0,1)},e.makeTranslation=function(t,n,o){return new e(1,0,0,0,0,1,0,0,0,0,1,0,t,n,o,1)},e.makeXRotation=function(t){var n=Math.sin(t),o=Math.cos(t);return new e(1,0,0,0,0,o,n,0,0,-n,o,0,0,0,0,1)},e.makeYRotation=function(t){var n=Math.sin(t),o=Math.cos(t);return new e(o,0,-n,0,0,1,0,0,n,0,o,0,0,0,0,1)},e.makeZRotation=function(t){var n=Math.sin(t),o=Math.cos(t);return new e(o,n,0,0,-n,o,0,0,0,0,1,0,0,0,0,1)},e.makePerspective=function(t,n,o,i){var r=Math.tan(.5*Math.PI-.5*t),a=1/(o-i);return new e(r/n,0,0,0,0,r,0,0,0,0,(o+i)*a,-1,0,0,o*i*a*2,0)},e.makeLookAtMatrix=function(t,n,o){var i=s.normalize(s.subtract(t,n)),r=s.normalize(s.vectorCrossProduct(o,i)),a=s.normalize(s.vectorCrossProduct(i,r));return new e(r.x,r.y,r.z,0,a.x,a.y,a.z,0,i.x,i.y,i.z,0,t.x,t.y,t.z,1)},e.makeViewMatrix=function(t,n,o){var i=s.normalize(s.subtract(t,n)),r=s.normalize(s.vectorCrossProduct(o,i)),a=s.vectorCrossProduct(i,r);return new e(r.x,a.x,i.x,0,r.y,a.y,i.y,0,r.z,a.z,i.z,0,-s.dotProduct(r,t),-s.dotProduct(a,t),-s.dotProduct(i,t),1)},e.multiplyMatrix4ByVector4=function(t,e){return new c(e.x*t.getElementAt(0,0)+e.y*t.getElementAt(0,1)+e.z*t.getElementAt(0,2)+e.w*t.getElementAt(0,3),e.x*t.getElementAt(1,0)+e.y*t.getElementAt(1,1)+e.z*t.getElementAt(1,2)+e.w*t.getElementAt(1,3),e.x*t.getElementAt(2,0)+e.y*t.getElementAt(2,1)+e.z*t.getElementAt(2,2)+e.w*t.getElementAt(2,3),e.x*t.getElementAt(3,0)+e.y*t.getElementAt(3,1)+e.z*t.getElementAt(3,2)+e.w*t.getElementAt(3,3))},e.multiplyMatrices4=function(t,n){for(var o=new e,i=0;i<4;i++)for(var r=0;r<4;r++){var a=n.getElementAt(i,0)*t.getElementAt(0,r)+n.getElementAt(i,1)*t.getElementAt(1,r)+n.getElementAt(i,2)*t.getElementAt(2,r)+n.getElementAt(i,3)*t.getElementAt(3,r);o.setElementAt(i,r,a)}return o},e.transpose=function(t){for(var n=new e,o=0;o<4;o++)for(var i=0;i<4;i++)n.setElementAt(o,i,t.getElementAt(i,o));return n},e.copy=function(t){for(var n=new e,o=0;o<4;o++)for(var i=0;i<4;i++)n.setElementAt(o,i,t.getElementAt(o,i));return n},e.inverse=function(t){var n=t.getElementAt(0,0),o=t.getElementAt(1,0),i=t.getElementAt(2,0),r=t.getElementAt(3,0),a=t.getElementAt(0,1),s=t.getElementAt(1,1),c=t.getElementAt(2,1),u=t.getElementAt(3,1),l=t.getElementAt(0,2),h=t.getElementAt(1,2),f=t.getElementAt(2,2),m=t.getElementAt(3,2),x=t.getElementAt(0,3),p=t.getElementAt(1,3),d=t.getElementAt(2,3),E=t.getElementAt(3,3),y=f*E,A=d*m,g=c*E,T=d*u,w=c*m,v=f*u,_=i*E,R=d*r,b=i*m,L=f*r,M=i*u,U=c*r,P=l*p,S=x*h,C=a*p,D=x*s,z=a*h,O=l*s,F=n*p,G=x*o,j=n*h,N=l*o,B=n*s,I=a*o,X=y*s+T*h+w*p-(A*s+g*h+v*p),k=A*o+_*h+L*p-(y*o+R*h+b*p),W=g*o+R*s+M*p-(T*o+_*s+U*p),V=v*o+b*s+U*h-(w*o+L*s+M*h),Y=1/(n*X+a*k+l*W+x*V);return new e(Y*X,Y*k,Y*W,Y*V,Y*(A*a+g*l+v*x-(y*a+T*l+w*x)),Y*(y*n+R*l+b*x-(A*n+_*l+L*x)),Y*(T*n+_*a+U*x-(g*n+R*a+M*x)),Y*(w*n+L*a+M*l-(v*n+b*a+U*l)),Y*(P*u+D*m+z*E-(S*u+C*m+O*E)),Y*(S*r+F*m+N*E-(P*r+G*m+j*E)),Y*(C*r+G*u+B*E-(D*r+F*u+I*E)),Y*(O*r+j*u+I*m-(z*r+N*u+B*m)),Y*(C*f+O*d+S*c-(z*d+P*c+D*f)),Y*(j*d+P*i+G*f-(F*f+N*d+S*i)),Y*(F*c+I*d+D*i-(B*d+C*i+G*c)),Y*(B*f+z*i+N*c-(j*c+I*f+O*i)))},e.compose=function(t,n,o){var i=e.makeIdentity(),r=o.x+o.x,a=o.y+o.y,s=o.z+o.z,c=o.x*r,u=o.x*a,l=o.x*s,h=o.y*a,f=o.y*s,m=o.z*s,x=o.w*r,p=o.w*a,d=o.w*s;return i.elements[0]=(1-(h+m))*n.x,i.elements[1]=(u+d)*n.x,i.elements[2]=(l-p)*n.x,i.elements[3]=0,i.elements[4]=(u-d)*n.y,i.elements[5]=(1-(c+m))*n.y,i.elements[6]=(f+x)*n.y,i.elements[7]=0,i.elements[8]=(l+p)*n.z,i.elements[9]=(f-x)*n.z,i.elements[10]=(1-(c+h))*n.z,i.elements[11]=0,i.elements[12]=t.x,i.elements[13]=t.y,i.elements[14]=t.z,i.elements[15]=1,i},e.decompose=function(n){var o=new s,i=new t,r=new s,a=n.elements.slice(0,3),c=n.elements.slice(4,7),u=n.elements.slice(8,11),l=s.magnitude(new s(a[0],a[1],a[2])),h=s.magnitude(new s(c[0],c[1],c[2])),f=s.magnitude(new s(u[0],u[1],u[2]));this.determinate(n)<0&&(l=-l),o.x=n.elements[12],o.y=n.elements[13],o.z=n.elements[14];var m=e.copy(n),x=1/l,p=1/h,d=1/f;return m.elements[0]*=x,m.elements[1]*=x,m.elements[2]*=x,m.elements[4]*=p,m.elements[5]*=p,m.elements[6]*=p,m.elements[8]*=d,m.elements[9]*=d,m.elements[10]*=d,i=t.fromMatrix4(m),r.x=l,r.y=h,r.z=f,[o,i,r]},e.determinate=function(t){var e=t.getElementAt(0,0),n=t.getElementAt(1,0),o=t.getElementAt(2,0),i=t.getElementAt(3,0),r=t.getElementAt(0,1),a=t.getElementAt(1,1),s=t.getElementAt(2,1),c=t.getElementAt(3,1),u=t.getElementAt(0,2),l=t.getElementAt(1,2),h=t.getElementAt(2,2),f=t.getElementAt(3,2),m=t.getElementAt(0,3),x=t.getElementAt(1,3),p=t.getElementAt(2,3),d=t.getElementAt(3,3),E=h*d,y=p*f,A=s*d,g=p*c,T=s*f,w=h*c,v=o*d,_=p*i,R=o*f,b=h*i,L=o*c,M=s*i;return 1/(e*(E*a+g*l+T*x-(y*a+A*l+w*x))+r*(y*n+v*l+b*x-(E*n+_*l+R*x))+u*(A*n+_*a+L*x-(g*n+v*a+M*x))+m*(w*n+R*a+M*l-(T*n+b*a+L*l)))},e}(),l=function(){function e(t,e,n){this.reset(t,e,n)}return Object.defineProperty(e.prototype,"up",{get:function(){return this.computeDirectionVectors(),this._up},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.computeDirectionVectors(),this._right},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forward",{get:function(){return this.computeDirectionVectors(),this._forward},enumerable:!1,configurable:!0}),e.prototype.reset=function(e,n,o){this.position=null!=e?e:new s,this.rotation=null!=n?n:new t,this.scale=null!=o?o:new s(1,1,1),this._forward=s.forward,this._right=s.right,this._up=s.up,this.shouldComputeDirections=!0},e.prototype.computeDirectionVectors=function(){if(this.shouldComputeDirections){var t=this.rotation.toMatrix4();this._up=u.multiplyMatrix4ByVector4(t,c.up),this._forward=u.multiplyMatrix4ByVector4(t,c.forward),this._right=u.multiplyMatrix4ByVector4(t,c.right),this.shouldComputeDirections=!1}},e.prototype.translate=function(t){this.position=s.add(this.position,t)},e.prototype.rotate=function(t){this.rotation.rotate(t.x,t.y,t.z),this.shouldComputeDirections=!0},e.prototype.setRotation=function(e){this.rotation=new t,this.rotation.rotate(e.x,e.y,e.z),this.shouldComputeDirections=!0},e.prototype.updateLocalMatrix=function(){this.localMatrix=u.makeIdentity();var t=u.makeTranslation(this.position.x,this.position.y,this.position.z),e=this.rotation.toMatrix4(),n=u.makeScale(this.scale.x,this.scale.y,this.scale.z);this.localMatrix=u.multiplyMatrices4(t,this.localMatrix),this.localMatrix=u.multiplyMatrices4(e,this.localMatrix),this.localMatrix=u.multiplyMatrices4(n,this.localMatrix)},e.prototype.updateWorldMatrix=function(t){this.worldMatrix=t?u.multiplyMatrices4(this.localMatrix,t):u.copy(this.localMatrix)},e.prototype.getWorldMatrix=function(){return this.worldMatrix},e.prototype.getLocalMatrix=function(){return this.localMatrix},e}(),h=function(){function t(t){this.transform=null!=t?t:new l,this.children=[]}return t.prototype.setParent=function(t){if(this.parent){var e=this.parent.children.indexOf(this);e>=0&&this.parent.children.splice(e,1)}t&&t.addChild(this),this.parent=t},t.prototype.addChild=function(t){this.children.push(t)},t.prototype.updateTransforms=function(){if(this.transform.updateLocalMatrix(),this.parent){var t=this.parent.transform.getWorldMatrix();this.transform.updateWorldMatrix(t)}else this.transform.updateWorldMatrix();this.children.forEach((function(t){t.updateTransforms()}))},t}(),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=function(t){function e(e,n){var o=t.call(this,n)||this;return o.renderer=e,o}return f(e,t),e.prototype.bufferData=function(t,e,n){var o=this.renderer.getContext();o.bindBuffer(n,t),o.bufferData(n,e,WebGLRenderingContext.STATIC_DRAW)},e.prototype.render=function(t){this.renderer.render(this,t)},e}(h),x=function(){function e(t,e,n){this.position=t,this.rotation=e,this.scale=n}return e.prototype.getLocalMatrix=function(){var t=u.makeIdentity(),e=u.makeTranslation(this.position.x,this.position.y,this.position.z),n=this.rotation.toMatrix4(),o=u.makeScale(this.scale.x,this.scale.y,this.scale.z);return t=u.multiplyMatrices4(e,t),t=u.multiplyMatrices4(n,t),u.multiplyMatrices4(o,t)},e.interpolate=function(n,o,i){return new e(s.interpolate(n.position,o.position,i),t.interpolate(n.rotation,o.rotation,i),s.interpolate(n.scale,o.scale,i))},e}(),p=function(){function t(){}return t.computeTime=function(t){t*=.001,this.deltaTime=t-this.time,this.time=t},t.deltaTime=0,t.time=0,t}(),d=function(){function t(t){this.model=t}return t.prototype.doAnimation=function(t){this.currentTime=0,this.animation=t},t.prototype.update=function(){if(this.animation){this.increaseAnimationTime(p.deltaTime);var t=this.computeCurrentAnimationPose();this.applyPoseToJoints(t,this.model.rootJoint,this.model.transform.getWorldMatrix())}else this.applyPoseToJoints(null,this.model.rootJoint,this.model.transform.getWorldMatrix())},t.prototype.increaseAnimationTime=function(t){this.currentTime+=t,this.currentTime>this.animation.lengthInSeconds&&(this.currentTime%=this.animation.lengthInSeconds)},t.prototype.computeCurrentAnimationPose=function(){var t=this.getPreviousAndNextFrames(),e=t[0],n=t[1],o=this.calculateProgression(e,n);return this.interpolatePoses(e,n,o)},t.prototype.applyPoseToJoints=function(t,e,n){var o=this;if(t){var i=t[e.name],r=u.multiplyMatrices4(i.getLocalMatrix(),n);e.children.forEach((function(e){o.applyPoseToJoints(t,e,r)})),e.animatedMatrix=u.multiplyMatrices4(e.inverseBindMatrix,r)}else{var a=u.multiplyMatrices4(e.transform.getLocalMatrix(),n);e.children.forEach((function(t){o.applyPoseToJoints(null,t,a)})),e.animatedMatrix=u.multiplyMatrices4(e.inverseBindMatrix,a)}},t.prototype.getPreviousAndNextFrames=function(){for(var t=this.animation.keyframes,e=t[0],n=t[0],o=1;o<t.length&&!((n=t[o]).timestamp>this.currentTime);o++)e=t[o];return[e,n]},t.prototype.calculateProgression=function(t,e){var n=e.timestamp-t.timestamp;return(this.currentTime-t.timestamp)/n},t.prototype.interpolatePoses=function(t,e,n){var o={};for(var i in t.pose)o[i]=x.interpolate(t.pose[i],e.pose[i],n);return o},t}(),E=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=function(t){function e(e,n,o,i,r,a,s,c,u){var l=t.call(this,u)||this,h=l.renderer.getContext();return l.positions=h.createBuffer(),l.normals=h.createBuffer(),l.textureCoords=h.createBuffer(),l.indices=h.createBuffer(),l.joints=h.createBuffer(),l.weights=h.createBuffer(),l.indexCount=i.length,l.bufferData(l.indices,i,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER),l.bufferData(l.positions,e,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.normals,n,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.textureCoords,o,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.joints,r,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.weights,a,WebGLRenderingContext.ARRAY_BUFFER),l.rootJoint=null!=s?s:null,l.jointCount=null!=c?c:0,l.boneTexture=h.createTexture(),h.bindTexture(WebGLRenderingContext.TEXTURE_2D,l.boneTexture),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MIN_FILTER,WebGLRenderingContext.NEAREST),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MAG_FILTER,WebGLRenderingContext.NEAREST),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_S,WebGLRenderingContext.CLAMP_TO_EDGE),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_T,WebGLRenderingContext.CLAMP_TO_EDGE),s.updateTransforms(),l.animator=new d(l),l}return E(e,t),e.prototype.doAnimation=function(t){this.animator.doAnimation(t)},e.prototype.update=function(){this.animator.update();var t=new Float32Array(16*this.jointCount);!function e(n){var o=16*n.id;t.set(n.animatedMatrix.flatten(),o),n.children&&n.children.forEach((function(t){e(t)}))}(this.rootJoint);var e=this.renderer.getContext();e.bindTexture(e.TEXTURE_2D,this.boneTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,4,this.jointCount,0,e.RGBA,e.FLOAT,t)},e}(m),A=function(){function t(t,e){this.context=t,this.program=e}return t.prototype.getContext=function(){return this.context},t}(),g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),T=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.positionAttributeLocation=e.getAttribLocation(n,"a_position"),o.texCoordsAttributeLocation=e.getAttribLocation(n,"a_texcoord"),o.normalsAttributeLocation=e.getAttribLocation(n,"a_normal"),o.jointsAttributeLocation=e.getAttribLocation(n,"a_joints"),o.weightsAttributeLocation=e.getAttribLocation(n,"a_weights"),o.worldMatrixUniformLocation=e.getUniformLocation(n,"u_worldMatrix"),o.viewMatrixUniformLocation=e.getUniformLocation(n,"u_viewMatrix"),o.projectionMatrixUniformLocation=e.getUniformLocation(n,"u_projectionMatrix"),o.worldInverseTransposeMatrixLocation=e.getUniformLocation(n,"u_worldInverseTransposeMatrix"),o.reverseLightDirectionLocation=e.getUniformLocation(n,"u_reverseLightDirection"),o.jointTextureLocation=e.getUniformLocation(n,"u_jointTexture"),o.jointCountLocation=e.getUniformLocation(n,"u_numJoints"),o}return g(e,t),e.prototype.loadTexture=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.generateMipmap(this.context.TEXTURE_2D),e},e.prototype.loadTexture2=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,1,1,0,this.context.RGBA,this.context.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),e},e.prototype.clear=function(){this.context.clearColor(.5,.5,.5,1),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT)},e.prototype.render=function(t,e){var n=e.getPerspectiveMatrix(),o=u.makeViewMatrix(e.transform.position,s.add(e.transform.position,e.transform.forward),s.up);this.context.viewport(0,0,this.context.canvas.width,this.context.canvas.height),this.context.useProgram(this.program),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.context.uniform1i(this.jointTextureLocation,1),this.context.uniform1f(this.jointCountLocation,t.jointCount),this.context.uniformMatrix4fv(this.worldMatrixUniformLocation,!1,t.transform.getWorldMatrix().flatten()),this.context.uniformMatrix4fv(this.projectionMatrixUniformLocation,!1,n.flatten()),this.context.uniformMatrix4fv(this.viewMatrixUniformLocation,!1,o.flatten()),this.context.uniform1f(this.jointCountLocation,t.jointCount);var i=u.inverse(t.transform.getWorldMatrix());this.context.uniformMatrix4fv(this.worldInverseTransposeMatrixLocation,!1,u.transpose(i).flatten());var r=s.normalize(new s(.5,.7,1));this.context.uniform3fv(this.reverseLightDirectionLocation,new Float32Array([r.x,r.y,r.z])),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.positions),this.context.enableVertexAttribArray(this.positionAttributeLocation),this.context.vertexAttribPointer(this.positionAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.textureCoords),this.context.enableVertexAttribArray(this.texCoordsAttributeLocation),this.context.vertexAttribPointer(this.texCoordsAttributeLocation,2,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.normals),this.context.enableVertexAttribArray(this.normalsAttributeLocation),this.context.vertexAttribPointer(this.normalsAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.joints),this.context.enableVertexAttribArray(this.jointsAttributeLocation),this.context.vertexAttribPointer(this.jointsAttributeLocation,4,this.context.UNSIGNED_BYTE,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.weights),this.context.enableVertexAttribArray(this.weightsAttributeLocation),this.context.vertexAttribPointer(this.weightsAttributeLocation,4,this.context.FLOAT,!1,0,0),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,t.texture),this.context.activeTexture(this.context.TEXTURE1),this.context.bindTexture(this.context.TEXTURE_2D,t.boneTexture),this.context.drawElements(WebGLRenderingContext.TRIANGLES,t.indexCount,this.context.UNSIGNED_SHORT,0)},e}(A),w=function(t,e){this.timestamp=t,this.pose=e},v=function(){function e(t,e,n){this.name=t,this.keyframes=e,this.lengthInSeconds=n}return e.fromGLTFAnimation=function(n){var o,i=n.animationLength,r=n.animationName,a=[];return n.jointsAnimations[0].translation.samples?o=n.jointsAnimations[0].translation.samples:n.jointsAnimations[0].rotation.samples?o=n.jointsAnimations[0].rotation.samples:n.jointsAnimations[0].scale.samples&&(o=n.jointsAnimations[0].scale.samples),o.map((function(t){return t.timestamp})).forEach((function(e,o){var i={};n.jointsAnimations.forEach((function(e){var n=new s(e.translation.samples[o].values[0],e.translation.samples[o].values[1],e.translation.samples[o].values[2]),r=new t(e.rotation.samples[o].values[0],e.rotation.samples[o].values[1],e.rotation.samples[o].values[2],e.rotation.samples[o].values[3]),a=new s(e.scale.samples[o].values[0],e.scale.samples[o].values[1],e.scale.samples[o].values[2]);i[e.jointName]=new x(n,r,a)})),a.push(new w(e,i))})),new e(r,a,i)},e}(),_=function(){function t(){}return t.loadFromScript=function(t,e,n){var o=t.createShader(n);if(t.shaderSource(o,e.text),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS))return o;console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(o))},t.createProgram=function(t,e,n){var o=t.createProgram();return t.attachShader(o,e),t.attachShader(o,n),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(o)),t.deleteProgram(o),null)},t}(),R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(e,n,o,i){var r=t.call(this,o)||this;return r.id=e,r.name=n,r.inverseBindMatrix=i,r}return R(e,t),e}(h),L=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},M=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},U=function(){function e(){}return e.loadGltf=function(e,n){return L(this,void 0,void 0,(function(){function o(t,e,n){var o=e.accessors[t],r=e.bufferViews[o.bufferView],a=function(t,e,n,o){switch(o){case i.FLOAT:return new Float32Array(t,e,n/Float32Array.BYTES_PER_ELEMENT);case i.SHORT:return new Int16Array(t,e,n/Int16Array.BYTES_PER_ELEMENT);case i.UNSIGNED_BYTE:return new Uint8Array(t,e,n/Uint8Array.BYTES_PER_ELEMENT);case i.UNSIGNED_INTEGER:return new Uint32Array(t,e,n/Uint32Array.BYTES_PER_ELEMENT);case i.UNSIGNED_SHORT:return new Uint16Array(t,e,n/Uint16Array.BYTES_PER_ELEMENT);default:return console.error("ComponentType not found: ",o),null}}(n[r.buffer],r.byteOffset,r.byteLength,o.componentType);return{max:o.max,min:o.min,type:o.type,data:a}}var a,h,f,m,x,p,d=this;return M(this,(function(i){switch(i.label){case 0:return a={positionData:null,normalData:null,texCoordData:null,indicesData:null,jointData:null,weightData:null,rootJoint:null,jointCount:0,animations:[]},[4,this.loadJson(e)];case 1:return f=i.sent(),m=new URL(e,location.href),[4,Promise.all(f.buffers.map((function(t){var e=new URL(t.uri,m.href);return d.loadArrayBuffer(e.href)})))];case 2:return x=i.sent(),f.meshes[n].primitives.forEach((function(t){var e=t.attributes.POSITION,n=t.attributes.NORMAL,i=t.attributes.TEXCOORD_0,r=t.attributes.JOINTS_0,s=t.attributes.WEIGHTS_0,c=t.indices;a.positionData=o(e,f,x).data,a.normalData=o(n,f,x).data,a.texCoordData=o(i,f,x).data,a.jointData=o(r,f,x).data,a.weightData=o(s,f,x).data,a.indicesData=o(c,f,x).data})),f.skins.forEach((function(e){var n=e.joints.map((function(t){return f.nodes[t]}));n[0].isRoot=!0;var o=f.accessors[e.inverseBindMatrices],i=f.bufferViews[o.bufferView],r=x[i.buffer];h=new Float32Array(r,i.byteOffset,i.byteLength/Float32Array.BYTES_PER_ELEMENT);for(var m=new Array(h.length/16),d=0;d<m.length;d++){var E=16*d;m[d]=new u(h[0+E],h[1+E],h[2+E],h[3+E],h[4+E],h[5+E],h[6+E],h[7+E],h[8+E],h[9+E],h[10+E],h[11+E],h[12+E],h[13+E],h[14+E],h[15+E])}for(p=new Array(n.length),d=0;d<n.length;d++){var y=new s(0,0,0),A=new c(0,0,0,1),g=new s(1,1,1);n[d].translation&&(y.x=n[d].translation[0],y.y=n[d].translation[1],y.z=n[d].translation[2]),n[d].rotation&&(A.x=n[d].rotation[0],A.y=n[d].rotation[1],A.z=n[d].rotation[2],A.w=n[d].rotation[3]),n[d].scale&&(g.x=n[d].scale[0],g.y=n[d].scale[1],g.z=n[d].scale[2]);var T=m[d],w=new t(A.x,A.y,A.z,A.w),v=new l(y,w,g);p[d]=new b(d,n[d].name,v,T)}var _=function(t){n[t].children&&n[t].children.forEach((function(e){p.find((function(t){return t.name===f.nodes[e].name})).setParent(p[t])}))};for(d=0;d<n.length;d++)_(d);a.rootJoint=p[0],a.jointCount=p.length})),f.animations.forEach((function(t,e){var n=0,i={},s={};i.animationName=t.name?t.name:"anim"+e,t.channels.forEach((function(e,i){var a=t.samplers[e.sampler],c=o(a.input,f,x),u=o(a.output,f,x),l=f.nodes[e.target.node],h=l.name?l.name:"joint"+i;s[h]||(s[h]={jointName:h});var m=s[h],p=[];switch(c.data.forEach((function(t,e){t*=1;var o=r[u.type],i=e*o;n=Math.max(n,t);var a=Array.from(u.data.slice(i,i+o));p.push({timestamp:t,values:a})})),e.target.path.toLowerCase()){case"translation":m.translation={interpolationMethod:a.interpolation,samples:p};break;case"rotation":m.rotation={interpolationMethod:a.interpolation,samples:p};break;case"scale":m.scale={interpolationMethod:a.interpolation,samples:p};break;default:console.error("path not implemented: ",e.target.path)}})),i.jointsAnimations=Object.values(s),i.animationLength=n,a.animations.push(i)})),[2,a]}}))}))},e.loadText=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().text()]}}))}))},e.loadJson=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().json()]}}))}))},e.loadImage=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){return[2,new Promise((function(e,n){var o=new Image;o.addEventListener("load",(function(){e(o)})),o.src=t}))]}))}))},e.loadArrayBuffer=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().arrayBuffer()]}}))}))},e}();!function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INTEGER=5125]="UNSIGNED_INTEGER",t[t.FLOAT=5126]="FLOAT"}(i||(i={})),function(t){t[t.SCALAR=1]="SCALAR",t[t.VEC2=2]="VEC2",t[t.VEC3=3]="VEC3",t[t.VEC4=4]="VEC4",t[t.MAT2=4]="MAT2",t[t.MAT3=9]="MAT3",t[t.MAT4=16]="MAT4"}(r||(r={}));var P,S,C,D,z=function(){function t(e,n,o,i){this.fieldOfView=e,this.aspectRatio=n,this.near=o,this.far=i,this.transform=new l,null===t.getActiveCamera()&&t.setActiveCamera(this)}return t.prototype.computePerspectiveMatrix=function(){this.perspectiveMatrix=u.makePerspective(this.fieldOfView,this.aspectRatio,this.near,this.far)},t.prototype.getPerspectiveMatrix=function(){return this.perspectiveMatrix},t.getActiveCamera=function(){return t.activeCamera},t.setActiveCamera=function(e){t.activeCamera=e},t.activeCamera=null,t}(),O=function(){function t(t,e,n){this.activeCamera=null!=t?t:null,this.globalLightDirection=null!=e?e:null,this.rootNodes=null!=n?n:[],this.renderables=[]}return t.prototype.update=function(){this.rootNodes.forEach((function(t){t.updateTransforms()}))},t.prototype.render=function(){var t=this;this.renderables.forEach((function(e){e.update(),e.render(t.activeCamera)}))},t}(),F=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),G=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.positionAttributeLocation=e.getAttribLocation(n,"a_position"),o.texCoordsAttributeLocation=e.getAttribLocation(n,"a_texcoord"),o.normalsAttributeLocation=e.getAttribLocation(n,"a_normal"),o.worldMatrixUniformLocation=e.getUniformLocation(n,"u_worldMatrix"),o.viewMatrixUniformLocation=e.getUniformLocation(n,"u_viewMatrix"),o.projectionMatrixUniformLocation=e.getUniformLocation(n,"u_projectionMatrix"),o.worldInverseTransposeMatrixLocation=e.getUniformLocation(n,"u_worldInverseTransposeMatrix"),o.reverseLightDirectionLocation=e.getUniformLocation(n,"u_reverseLightDirection"),o}return F(e,t),e.prototype.loadTexture=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.generateMipmap(this.context.TEXTURE_2D),e},e.prototype.loadTexture2=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,1,1,0,this.context.RGBA,this.context.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),e},e.prototype.clear=function(){this.context.clearColor(.5,.5,.5,1),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT)},e.prototype.render=function(t,e){var n=e.getPerspectiveMatrix(),o=u.makeViewMatrix(e.transform.position,s.add(e.transform.position,e.transform.forward),s.up);this.context.viewport(0,0,this.context.canvas.width,this.context.canvas.height),this.context.useProgram(this.program),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.context.uniformMatrix4fv(this.worldMatrixUniformLocation,!1,t.transform.getWorldMatrix().flatten()),this.context.uniformMatrix4fv(this.projectionMatrixUniformLocation,!1,n.flatten()),this.context.uniformMatrix4fv(this.viewMatrixUniformLocation,!1,o.flatten());var i=u.inverse(t.transform.getWorldMatrix());this.context.uniformMatrix4fv(this.worldInverseTransposeMatrixLocation,!1,u.transpose(i).flatten());var r=s.normalize(new s(.5,.7,1));this.context.uniform3fv(this.reverseLightDirectionLocation,new Float32Array([r.x,r.y,r.z])),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.positions),this.context.enableVertexAttribArray(this.positionAttributeLocation),this.context.vertexAttribPointer(this.positionAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.textureCoords),this.context.enableVertexAttribArray(this.texCoordsAttributeLocation),this.context.vertexAttribPointer(this.texCoordsAttributeLocation,2,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.normals),this.context.enableVertexAttribArray(this.normalsAttributeLocation),this.context.vertexAttribPointer(this.normalsAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,t.texture),this.context.drawElements(WebGLRenderingContext.TRIANGLES,t.indexCount,this.context.UNSIGNED_SHORT,0)},e}(A);window.onload=function(){window.onerror=function(t,e,n){return alert("Error occured: "+t),!1},I.loadingState.style.visibility="visible",I.loadedState.style.visibility="hidden",function(){var t=document.querySelector("#canvas"),n=document.querySelector("#vertex-shader-3d-textured-lit"),o=document.querySelector("#fragment-shader-3d-textured-lit"),i=document.querySelector("#vertex-shader-3d-textured-skinned"),r=document.querySelector("#fragment-shader-3d-textured-skinned"),a=t.getContext("webgl");if(a){if(!a.getExtension("OES_texture_float"))throw new Error("Could not run in your browser, sorry! More info: OES_texture_float extension missing!");var c=_.loadFromScript(a,n,a.VERTEX_SHADER),u=_.loadFromScript(a,o,a.FRAGMENT_SHADER),l=_.createProgram(a,c,u);C=new G(a,l),c=_.loadFromScript(a,i,a.VERTEX_SHADER),u=_.loadFromScript(a,r,a.FRAGMENT_SHADER),l=_.createProgram(a,c,u),D=new T(a,l);var h=t.clientWidth/t.clientHeight,f=e(60);N.cameraObj=new z(f,h,1,2e3),N.cameraObj.computePerspectiveMatrix(),N.cameraObj.transform.position=new s(-4.5,0,-2),N.cameraObj.transform.setRotation(new s(e(0),e(-45),e(0))),N.currentRotationAngles=new s(e(0),e(-45),e(0)),P=new O(N.cameraObj,s.normalize(new s(.5,.7,1)),[])}else console.error("Something went wrong while creating webgl context")}(),function(){return t=this,e=void 0,o=function(){return function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(t){return[2,U.loadGltf("./assets/whale.CYCLES.gltf",0)]}))},new((n=void 0)||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}));var t,e,n,o}().then((function(t){var n=D.loadTexture2(new c(0,0,255,255));(S=new y(t.positionData,t.normalData,t.texCoordData,t.indicesData,t.jointData,t.weightData,t.rootJoint,t.jointCount,D)).texture=n,P.rootNodes.push(S),P.renderables.push(S),k(),t.animations.forEach((function(t){j[t.animationName]=v.fromGLTFAnimation(t)})),function(t){t.forEach((function(t){var e=document.createElement("option");e.value=t,e.text=t,I.animationSelect.appendChild(e)}))}(Object.keys(j)),function(){I.animationSelect.addEventListener("change",(function(t){j[this.value]?(S.renderer=D,S.transform.position=new s(0,.6,-3),S.transform.scale=new s(1,1,1),S.transform.setRotation(new s(e(-45),0,0)),S.doAnimation(j[this.value])):k()})),document.addEventListener("keydown",(function(t){"w"===t.key?B.up=!0:"s"===t.key?B.down=!0:"a"===t.key?B.left=!0:"d"===t.key?B.right=!0:t.key})),document.addEventListener("keyup",(function(t){"w"===t.key?B.up=!1:"s"===t.key?B.down=!1:"a"===t.key?B.left=!1:"d"===t.key?B.right=!1:t.key}));var t=D.getContext().canvas;function n(t){var e=new s(t.movementY,t.movementX,0);N.Rotate(e)}t.addEventListener("click",(function(t){this.requestPointerLock()})),document.addEventListener("pointerlockchange",(function(){document.pointerLockElement===t?document.addEventListener("mousemove",n):document.removeEventListener("mousemove",n)}))}(),requestAnimationFrame(X),I.loadingState.style.visibility="hidden",I.loadedState.style.visibility="visible"}))};var j={},N={cameraObj:null,forwardVelocity:new s,rightVelocity:new s,maxXRotation:e(89),minXRotation:e(-89),currentRotationAngles:new s,cameraSpeed:20,mouseSensibility:.1,Move:function(t){var e=this.cameraObj,n=this.cameraSpeed*p.deltaTime,o=s.multiply(e.transform.forward,-t.z),i=s.multiply(e.transform.right,t.x),r=s.multiply(s.add(o,i),n);e.transform.translate(r)},Rotate:function(t){var e=this.cameraObj,n=this.mouseSensibility*p.deltaTime;this.currentRotationAngles.x-=n*t.x,this.currentRotationAngles.y-=n*t.y,this.currentRotationAngles.x>this.maxXRotation?this.currentRotationAngles.x=this.maxXRotation:this.currentRotationAngles.x<this.minXRotation&&(this.currentRotationAngles.x=this.minXRotation),e.transform.setRotation(this.currentRotationAngles)}},B={up:!1,down:!1,left:!1,right:!1},I={loadingState:document.querySelector("#loading-state"),loadedState:document.querySelector("#loaded-state"),xRotationElement:document.querySelector("#x-rotation"),yRotationElement:document.querySelector("#y-rotation"),zRotationElement:document.querySelector("#z-rotation"),animationSelect:document.querySelector("#select-animations")};function X(t){var e;p.computeTime(t),e=new s,B.up&&(e=s.add(e,s.forward)),B.down&&(e=s.add(e,s.backward)),B.right&&(e=s.add(e,s.right)),B.left&&(e=s.add(e,s.left)),N.Move(e),P.update(),D.clear(),P.render(),requestAnimationFrame(X)}function k(){S.renderer=C,S.transform.position=new s(0,-1,-7),S.transform.scale=new s(.4,.4,.4),S.transform.setRotation(new s(0,0,0))}})();
//# sourceMappingURL=main.js.map