(()=>{"use strict";function t(t){return t*Math.PI/180}function e(t,e,n){return(1-n)*t+n*e}var n,o,i,r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=function(t){function n(e,n,o){var i=t.call(this,null!=e?e:0,null!=n?n:0)||this;return i.z=null!=o?o:0,i}return r(n,t),n.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},n.normalize=function(t){var e=n.magnitude(t);return e>0?n.divide(t,e):new n(0,0,0)},n.add=function(t,e){return new n(t.x+e.x,t.y+e.y,t.z+e.z)},n.subtract=function(t,e){return new n(t.x-e.x,t.y-e.y,t.z-e.z)},n.multiply=function(t,e){return new n(t.x*e,t.y*e,t.z*e)},n.divide=function(t,e){return 0!==e?new n(t.x/e,t.y/e,t.z/e):(console.error("Can't divide by zero, Vector3 was not divided!"),t)},n.dotProduct=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},n.vectorCrossProduct=function(t,e){return new n(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},n.interpolate=function(t,o,i){return new n(e(t.x,o.x,i),e(t.y,o.y,i),e(t.z,o.z,i))},n.zero=new n(0,0,0),n.forward=new n(0,0,-1),n.backward=new n(0,0,1),n.up=new n(0,1,0),n.down=new n(0,-1,0),n.left=new n(-1,0,0),n.right=new n(1,0,0),n}(function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.normalize=function(e){var n=t.magnitude(e);return n>0?t.divide(e,n):new t(0,0)},t.add=function(e,n){return new t(e.x+n.x,e.y+n.y)},t.subtract=function(e,n){return new t(e.x-n.x,e.y-n.y)},t.multiply=function(e,n){return new t(e.x*n,e.y*n)},t.divide=function(e,n){return 0!==n?new t(e.x/n,e.y/n):(console.error("Can't divide by zero, Vector2 was not divided!"),e)},t.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},t}()),s=function(t){function e(e,n,o,i){var r=t.call(this,null!=e?e:0,null!=n?n:0,null!=o?o:0)||this;return r.w=null!=i?i:1,r}return r(e,t),e.forward=new e(0,0,-1,1),e.backward=new e(0,0,1,1),e.up=new e(0,1,0,1),e.down=new e(0,-1,0,1),e.left=new e(-1,0,0,1),e.right=new e(1,0,0,1),e}(a),c=function(){function t(t,e,n,o,i,r,a,s,c,u,l,h,f,x,m,p){this.elements=[null!=t?t:0,null!=e?e:0,null!=n?n:0,null!=o?o:0,null!=i?i:0,null!=r?r:0,null!=a?a:0,null!=s?s:0,null!=c?c:0,null!=u?u:0,null!=l?l:0,null!=h?h:0,null!=f?f:0,null!=x?x:0,null!=m?m:0,null!=p?p:0]}return t.prototype.getElementAt=function(t,e){return this.elements[4*e+t]},t.prototype.setElementAt=function(t,e,n){this.elements[4*e+t]=n},t.prototype.flatten=function(){return this.elements},t.makeIdentity=function(){return new t(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.makeScale=function(e,n,o){return new t(e,0,0,0,0,n,0,0,0,0,o,0,0,0,0,1)},t.makeTranslation=function(e,n,o){return new t(1,0,0,0,0,1,0,0,0,0,1,0,e,n,o,1)},t.makeXRotation=function(e){var n=Math.sin(e),o=Math.cos(e);return new t(1,0,0,0,0,o,n,0,0,-n,o,0,0,0,0,1)},t.makeYRotation=function(e){var n=Math.sin(e),o=Math.cos(e);return new t(o,0,-n,0,0,1,0,0,n,0,o,0,0,0,0,1)},t.makeZRotation=function(e){var n=Math.sin(e),o=Math.cos(e);return new t(o,n,0,0,-n,o,0,0,0,0,1,0,0,0,0,1)},t.makePerspective=function(e,n,o,i){var r=Math.tan(.5*Math.PI-.5*e),a=1/(o-i);return new t(r/n,0,0,0,0,r,0,0,0,0,(o+i)*a,-1,0,0,o*i*a*2,0)},t.makeLookAtMatrix=function(e,n,o){var i=a.normalize(a.subtract(e,n)),r=a.normalize(a.vectorCrossProduct(o,i)),s=a.normalize(a.vectorCrossProduct(i,r));return new t(r.x,r.y,r.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,1)},t.makeViewMatrix=function(e,n,o){var i=a.normalize(a.subtract(e,n)),r=a.normalize(a.vectorCrossProduct(o,i)),s=a.vectorCrossProduct(i,r);return new t(r.x,s.x,i.x,0,r.y,s.y,i.y,0,r.z,s.z,i.z,0,-a.dotProduct(r,e),-a.dotProduct(s,e),-a.dotProduct(i,e),1)},t.multiplyMatrix4ByVector4=function(t,e){return new s(e.x*t.getElementAt(0,0)+e.y*t.getElementAt(0,1)+e.z*t.getElementAt(0,2)+e.w*t.getElementAt(0,3),e.x*t.getElementAt(1,0)+e.y*t.getElementAt(1,1)+e.z*t.getElementAt(1,2)+e.w*t.getElementAt(1,3),e.x*t.getElementAt(2,0)+e.y*t.getElementAt(2,1)+e.z*t.getElementAt(2,2)+e.w*t.getElementAt(2,3),e.x*t.getElementAt(3,0)+e.y*t.getElementAt(3,1)+e.z*t.getElementAt(3,2)+e.w*t.getElementAt(3,3))},t.multiplyMatrices4=function(e,n){for(var o=new t,i=0;i<4;i++)for(var r=0;r<4;r++){var a=n.getElementAt(i,0)*e.getElementAt(0,r)+n.getElementAt(i,1)*e.getElementAt(1,r)+n.getElementAt(i,2)*e.getElementAt(2,r)+n.getElementAt(i,3)*e.getElementAt(3,r);o.setElementAt(i,r,a)}return o},t.transpose=function(e){for(var n=new t,o=0;o<4;o++)for(var i=0;i<4;i++)n.setElementAt(o,i,e.getElementAt(i,o));return n},t.copy=function(e){for(var n=new t,o=0;o<4;o++)for(var i=0;i<4;i++)n.setElementAt(o,i,e.getElementAt(o,i));return n},t.inverse=function(e){var n=e.getElementAt(0,0),o=e.getElementAt(1,0),i=e.getElementAt(2,0),r=e.getElementAt(3,0),a=e.getElementAt(0,1),s=e.getElementAt(1,1),c=e.getElementAt(2,1),u=e.getElementAt(3,1),l=e.getElementAt(0,2),h=e.getElementAt(1,2),f=e.getElementAt(2,2),x=e.getElementAt(3,2),m=e.getElementAt(0,3),p=e.getElementAt(1,3),E=e.getElementAt(2,3),d=e.getElementAt(3,3),A=f*d,y=E*x,T=c*d,g=E*u,w=c*x,v=f*u,_=i*d,R=E*r,b=i*x,L=f*r,M=i*u,U=c*r,C=l*p,D=m*h,P=a*p,S=m*s,z=a*h,O=l*s,F=n*p,B=m*o,G=n*h,j=l*o,N=n*s,I=a*o,X=A*s+g*h+w*p-(y*s+T*h+v*p),k=y*o+_*h+L*p-(A*o+R*h+b*p),W=T*o+R*s+M*p-(g*o+_*s+U*p),V=v*o+b*s+U*h-(w*o+L*s+M*h),Y=1/(n*X+a*k+l*W+m*V);return new t(Y*X,Y*k,Y*W,Y*V,Y*(y*a+T*l+v*m-(A*a+g*l+w*m)),Y*(A*n+R*l+b*m-(y*n+_*l+L*m)),Y*(g*n+_*a+U*m-(T*n+R*a+M*m)),Y*(w*n+L*a+M*l-(v*n+b*a+U*l)),Y*(C*u+S*x+z*d-(D*u+P*x+O*d)),Y*(D*r+F*x+j*d-(C*r+B*x+G*d)),Y*(P*r+B*u+N*d-(S*r+F*u+I*d)),Y*(O*r+G*u+I*x-(z*r+j*u+N*x)),Y*(P*f+O*E+D*c-(z*E+C*c+S*f)),Y*(G*E+C*i+B*f-(F*f+j*E+D*i)),Y*(F*c+I*E+S*i-(N*E+P*i+B*c)),Y*(N*f+z*i+j*c-(G*c+I*f+O*i)))},t.compose=function(e,n,o){var i=t.makeIdentity(),r=o.x+o.x,a=o.y+o.y,s=o.z+o.z,c=o.x*r,u=o.x*a,l=o.x*s,h=o.y*a,f=o.y*s,x=o.z*s,m=o.w*r,p=o.w*a,E=o.w*s;return i.elements[0]=(1-(h+x))*n.x,i.elements[1]=(u+E)*n.x,i.elements[2]=(l-p)*n.x,i.elements[3]=0,i.elements[4]=(u-E)*n.y,i.elements[5]=(1-(c+x))*n.y,i.elements[6]=(f+m)*n.y,i.elements[7]=0,i.elements[8]=(l+p)*n.z,i.elements[9]=(f-m)*n.z,i.elements[10]=(1-(c+h))*n.z,i.elements[11]=0,i.elements[12]=e.x,i.elements[13]=e.y,i.elements[14]=e.z,i.elements[15]=1,i},t}(),u=function(){function t(t,e,n,o){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=n?n:0,this.w=null!=o?o:1,this.normalize()}return t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t>0&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t)},t.prototype.conjugate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w},t.prototype.rotate=function(e,n,o){var i=Math.cos(n/2),r=Math.sin(n/2),a=Math.cos(o/2),s=Math.sin(o/2),c=Math.cos(e/2),u=Math.sin(e/2),l=i*a,h=r*s,f=new t(l*u+h*c,r*a*c+i*s*u,i*s*c-r*a*u,l*c-h*u);this.multiply(f)},t.prototype.multiply=function(t){this.x=t.x*this.w+t.y*this.z-t.z*this.y+t.w*this.x,this.y=-t.x*this.z+t.y*this.w+t.z*this.x+t.w*this.y,this.z=t.x*this.y-t.y*this.x+t.z*this.w+t.w*this.z,this.w=-t.x*this.x-t.y*this.y-t.z*this.z+t.w*this.w},t.prototype.toMatrix4=function(){this.normalize();var t=this.w*this.w,e=this.x*this.x,n=this.y*this.y,o=this.z*this.z,i=e-n-o+t,r=-e+n-o+t,a=-e-n+o+t,s=this.x*this.y,u=this.z*this.w,l=2*(s+u),h=2*(s-u),f=2*((s=this.x*this.z)-(u=this.y*this.w)),x=2*(s+u);return s=this.y*this.z,u=this.x*this.w,new c(i,l,f,0,h,r,2*(s+u),0,x,2*(s-u),a,0,0,0,0,1)},t.fromMatrix4=function(e){var n,o,i,r,a=e.getElementAt(0,0)+e.getElementAt(1,1)+e.getElementAt(2,2);if(a>0){var s=2*Math.sqrt(a+1);n=(e.getElementAt(2,1)-e.getElementAt(1,2))/s,o=(e.getElementAt(0,2)-e.getElementAt(2,0))/s,i=(e.getElementAt(1,0)-e.getElementAt(0,1))/s,r=s/4}else if(e.getElementAt(0,0)>e.getElementAt(1,1)&&e.getElementAt(0,0)>e.getElementAt(2,2)){var c=2*Math.sqrt(1+e.getElementAt(0,0)-e.getElementAt(1,1)-e.getElementAt(2,2));n=c/4,o=(e.getElementAt(0,1)+e.getElementAt(1,0))/c,i=(e.getElementAt(0,2)+e.getElementAt(2,0))/c,r=(e.getElementAt(2,1)-e.getElementAt(1,2))/c}else if(e.getElementAt(1,1)>e.getElementAt(2,2)){var u=2*Math.sqrt(1+e.getElementAt(1,1)-e.getElementAt(0,0)-e.getElementAt(2,2));n=(e.getElementAt(0,1)+e.getElementAt(1,0))/u,o=u/4,i=(e.getElementAt(1,2)+e.getElementAt(2,1))/u,r=(e.getElementAt(0,2)-e.getElementAt(2,0))/u}else{var l=2*Math.sqrt(1+e.getElementAt(2,2)-e.getElementAt(0,0)-e.getElementAt(1,1));n=(e.getElementAt(0,2)+e.getElementAt(2,0))/l,o=(e.getElementAt(1,2)+e.getElementAt(2,1))/l,i=l/4,r=(e.getElementAt(1,0)-e.getElementAt(0,1))/l}return new t(n,o,i,r)},t.interpolate=function(e,n,o){var i=new t,r=e.x*n.x+e.y*n.y+e.z*n.z+e.w*n.w;if(Math.abs(r)>=1)return i.w=e.w,i.x=e.x,i.y=e.y,i.z=e.z,i;var a=Math.acos(r),s=Math.sqrt(1-r*r);if(Math.abs(s)<1e-5)return i.w=.5*e.w+.5*i.w,i.x=.5*e.x+.5*i.x,i.y=.5*e.y+.5*i.y,i.z=.5*e.z+.5*i.z,i;var c=Math.sin((1-o)*a)/s,u=Math.sin(o*a)/s;return i.w=e.w*c+n.w*u,i.x=e.x*c+n.x*u,i.y=e.y*c+n.y*u,i.z=e.z*c+n.z*u,i},t}(),l=function(){function t(t,e,n){this.reset(t,e,n)}return Object.defineProperty(t.prototype,"up",{get:function(){return this.computeDirectionVectors(),this._up},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.computeDirectionVectors(),this._right},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return this.computeDirectionVectors(),this._forward},enumerable:!1,configurable:!0}),t.prototype.reset=function(t,e,n){this.position=null!=t?t:new a,this.rotation=null!=e?e:new u,this.scale=null!=n?n:new a(1,1,1),this._forward=a.forward,this._right=a.right,this._up=a.up,this.shouldComputeDirections=!0},t.prototype.computeDirectionVectors=function(){if(this.shouldComputeDirections){var t=this.rotation.toMatrix4();this._up=c.multiplyMatrix4ByVector4(t,s.up),this._forward=c.multiplyMatrix4ByVector4(t,s.forward),this._right=c.multiplyMatrix4ByVector4(t,s.right),this.shouldComputeDirections=!1}},t.prototype.translate=function(t){this.position=a.add(this.position,t)},t.prototype.rotate=function(t){this.rotation.rotate(t.x,t.y,t.z),this.shouldComputeDirections=!0},t.prototype.setRotation=function(t){this.rotation=new u,this.rotation.rotate(t.x,t.y,t.z),this.shouldComputeDirections=!0},t.prototype.updateLocalMatrix=function(){this.localMatrix=c.makeIdentity();var t=c.makeTranslation(this.position.x,this.position.y,this.position.z),e=this.rotation.toMatrix4(),n=c.makeScale(this.scale.x,this.scale.y,this.scale.z);this.localMatrix=c.multiplyMatrices4(t,this.localMatrix),this.localMatrix=c.multiplyMatrices4(e,this.localMatrix),this.localMatrix=c.multiplyMatrices4(n,this.localMatrix)},t.prototype.updateWorldMatrix=function(t){this.worldMatrix=t?c.multiplyMatrices4(this.localMatrix,t):c.copy(this.localMatrix)},t.prototype.getWorldMatrix=function(){return this.worldMatrix},t.prototype.getLocalMatrix=function(){return this.localMatrix},t}(),h=function(){function t(t){this.transform=null!=t?t:new l,this.children=[]}return t.prototype.setParent=function(t){if(this.parent){var e=this.parent.children.indexOf(this);e>=0&&this.parent.children.splice(e,1)}t&&t.addChild(this),this.parent=t},t.prototype.addChild=function(t){this.children.push(t)},t.prototype.updateTransforms=function(){if(this.transform.updateLocalMatrix(),this.parent){var t=this.parent.transform.getWorldMatrix();this.transform.updateWorldMatrix(t)}else this.transform.updateWorldMatrix();this.children.forEach((function(t){t.updateTransforms()}))},t}(),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(t){function e(e,n){var o=t.call(this,n)||this;return o.renderer=e,o}return f(e,t),e.prototype.bufferData=function(t,e,n){var o=this.renderer.getContext();o.bindBuffer(n,t),o.bufferData(n,e,WebGLRenderingContext.STATIC_DRAW)},e.prototype.render=function(t){this.renderer.render(this,t)},e}(h),m=function(){function t(t,e,n){this.position=t,this.rotation=e,this.scale=n}return t.prototype.getLocalMatrix=function(){var t=c.makeIdentity(),e=c.makeTranslation(this.position.x,this.position.y,this.position.z),n=this.rotation.toMatrix4(),o=c.makeScale(this.scale.x,this.scale.y,this.scale.z);return t=c.multiplyMatrices4(e,t),t=c.multiplyMatrices4(n,t),c.multiplyMatrices4(o,t)},t.interpolate=function(e,n,o){return new t(a.interpolate(e.position,n.position,o),u.interpolate(e.rotation,n.rotation,o),a.interpolate(e.scale,n.scale,o))},t}(),p=function(){function t(){}return t.computeTime=function(t){t*=.001,this.deltaTime=t-this.time,this.time=t},t.deltaTime=0,t.time=0,t}(),E=function(){function t(t){this.model=t}return t.prototype.doAnimation=function(t){this.currentTime=0,this.animation=t},t.prototype.update=function(){if(this.animation){this.increaseAnimationTime(p.deltaTime);var t=this.computeCurrentAnimationPose();this.applyPoseToJoints(t,this.model.rootJoint,this.model.transform.getWorldMatrix())}},t.prototype.increaseAnimationTime=function(t){this.currentTime+=t,this.currentTime>this.animation.lengthInSeconds&&(this.currentTime%=this.animation.lengthInSeconds)},t.prototype.computeCurrentAnimationPose=function(){var t=this.getPreviousAndNextFrames(),e=t[0],n=t[1],o=this.calculateProgression(e,n);return this.interpolatePoses(e,n,o)},t.prototype.applyPoseToJoints=function(t,e,n){var o=this,i=t[e.name],r=c.multiplyMatrices4(i.getLocalMatrix(),n);e.children.forEach((function(e){o.applyPoseToJoints(t,e,r)})),e.animatedMatrix=c.multiplyMatrices4(e.inverseBindMatrix,r)},t.prototype.getPreviousAndNextFrames=function(){for(var t=this.animation.keyframes,e=t[0],n=t[0],o=1;o<t.length&&!((n=t[o]).timestamp>this.currentTime);o++)e=t[o];return[e,n]},t.prototype.calculateProgression=function(t,e){var n=e.timestamp-t.timestamp;return(this.currentTime-t.timestamp)/n},t.prototype.interpolatePoses=function(t,e,n){var o={};for(var i in t.pose)o[i]=m.interpolate(t.pose[i],e.pose[i],n);return o},t}(),d=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),A=function(t){function e(e,n,o,i,r,a,s,c,u){var l=t.call(this,u)||this,h=l.renderer.getContext();return l.positions=h.createBuffer(),l.normals=h.createBuffer(),l.textureCoords=h.createBuffer(),l.indices=h.createBuffer(),l.joints=h.createBuffer(),l.weights=h.createBuffer(),l.indexCount=i.length,l.bufferData(l.indices,i,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER),l.bufferData(l.positions,e,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.normals,n,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.textureCoords,o,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.joints,r,WebGLRenderingContext.ARRAY_BUFFER),l.bufferData(l.weights,a,WebGLRenderingContext.ARRAY_BUFFER),l.rootJoint=null!=s?s:null,l.jointCount=null!=c?c:0,l.boneTexture=h.createTexture(),h.bindTexture(WebGLRenderingContext.TEXTURE_2D,l.boneTexture),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MIN_FILTER,WebGLRenderingContext.NEAREST),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MAG_FILTER,WebGLRenderingContext.NEAREST),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_S,WebGLRenderingContext.CLAMP_TO_EDGE),h.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_T,WebGLRenderingContext.CLAMP_TO_EDGE),s&&s.setParent(l),l.animator=new E(l),l}return d(e,t),e.prototype.doAnimation=function(t){this.animator.doAnimation(t)},e.prototype.update=function(){this.animator.update();var t=new Float32Array(16*this.jointCount);!function e(n){var o=16*n.id;t.set(n.animatedMatrix.flatten(),o),n.children&&n.children.forEach((function(t){e(t)}))}(this.rootJoint);var e=this.renderer.getContext();e.bindTexture(e.TEXTURE_2D,this.boneTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,4,this.jointCount,0,e.RGBA,e.FLOAT,t)},e}(x),y=function(){function t(t,e){this.context=t,this.program=e}return t.prototype.getContext=function(){return this.context},t}(),T=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.positionAttributeLocation=e.getAttribLocation(n,"a_position"),o.texCoordsAttributeLocation=e.getAttribLocation(n,"a_texcoord"),o.normalsAttributeLocation=e.getAttribLocation(n,"a_normal"),o.jointsAttributeLocation=e.getAttribLocation(n,"a_joints"),o.weightsAttributeLocation=e.getAttribLocation(n,"a_weights"),o.worldMatrixUniformLocation=e.getUniformLocation(n,"u_worldMatrix"),o.viewMatrixUniformLocation=e.getUniformLocation(n,"u_viewMatrix"),o.projectionMatrixUniformLocation=e.getUniformLocation(n,"u_projectionMatrix"),o.worldInverseTransposeMatrixLocation=e.getUniformLocation(n,"u_worldInverseTransposeMatrix"),o.reverseLightDirectionLocation=e.getUniformLocation(n,"u_reverseLightDirection"),o.jointTextureLocation=e.getUniformLocation(n,"u_jointTexture"),o.jointCountLocation=e.getUniformLocation(n,"u_numJoints"),o}return T(e,t),e.prototype.loadTexture=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.generateMipmap(this.context.TEXTURE_2D),e},e.prototype.loadTexture2=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,1,1,0,this.context.RGBA,this.context.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),e},e.prototype.clear=function(){this.context.clearColor(.5,.5,.5,1),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT)},e.prototype.render=function(t,e){var n=e.getPerspectiveMatrix(),o=c.makeViewMatrix(e.transform.position,a.add(e.transform.position,e.transform.forward),a.up);this.context.viewport(0,0,this.context.canvas.width,this.context.canvas.height),this.context.useProgram(this.program),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.context.uniform1i(this.jointTextureLocation,1),this.context.uniform1f(this.jointCountLocation,t.jointCount),this.context.uniformMatrix4fv(this.worldMatrixUniformLocation,!1,t.transform.getWorldMatrix().flatten()),this.context.uniformMatrix4fv(this.projectionMatrixUniformLocation,!1,n.flatten()),this.context.uniformMatrix4fv(this.viewMatrixUniformLocation,!1,o.flatten()),this.context.uniform1f(this.jointCountLocation,t.jointCount);var i=c.inverse(t.transform.getWorldMatrix());this.context.uniformMatrix4fv(this.worldInverseTransposeMatrixLocation,!1,c.transpose(i).flatten());var r=a.normalize(new a(.5,.7,1));this.context.uniform3fv(this.reverseLightDirectionLocation,new Float32Array([r.x,r.y,r.z])),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.positions),this.context.enableVertexAttribArray(this.positionAttributeLocation),this.context.vertexAttribPointer(this.positionAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.textureCoords),this.context.enableVertexAttribArray(this.texCoordsAttributeLocation),this.context.vertexAttribPointer(this.texCoordsAttributeLocation,2,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.normals),this.context.enableVertexAttribArray(this.normalsAttributeLocation),this.context.vertexAttribPointer(this.normalsAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.joints),this.context.enableVertexAttribArray(this.jointsAttributeLocation),this.context.vertexAttribPointer(this.jointsAttributeLocation,4,this.context.UNSIGNED_BYTE,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.weights),this.context.enableVertexAttribArray(this.weightsAttributeLocation),this.context.vertexAttribPointer(this.weightsAttributeLocation,4,this.context.FLOAT,!1,0,0),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,t.texture),this.context.activeTexture(this.context.TEXTURE1),this.context.bindTexture(this.context.TEXTURE_2D,t.boneTexture),this.context.drawElements(WebGLRenderingContext.TRIANGLES,t.indexCount,this.context.UNSIGNED_SHORT,0)},e}(y),w=function(t,e){this.timestamp=t,this.pose=e},v=function(){function t(t,e,n){this.name=t,this.keyframes=e,this.lengthInSeconds=n}return t.fromGLTFAnimation=function(e){var n,o=e.animationLength,i=e.animationName,r=[];return e.jointsAnimations[0].jointName,e.jointsAnimations[0].translation.samples?n=e.jointsAnimations[0].translation.samples:e.jointsAnimations[0].rotation.samples?n=e.jointsAnimations[0].rotation.samples:e.jointsAnimations[0].scale.samples&&(n=e.jointsAnimations[0].scale.samples),n.map((function(t){return t.timestamp})).forEach((function(t,n){var o={};e.jointsAnimations.forEach((function(t){var e=new a(t.translation.samples[n].values[0],t.translation.samples[n].values[1],t.translation.samples[n].values[2]),i=new u(t.rotation.samples[n].values[0],t.rotation.samples[n].values[1],t.rotation.samples[n].values[2],t.rotation.samples[n].values[3]),r=new a(t.scale.samples[n].values[0],t.scale.samples[n].values[1],t.scale.samples[n].values[2]);o[t.jointName]=new m(e,i,r)})),r.push(new w(t,o))})),console.log("HumbleAnimation",i,r,o),new t(i,r,o)},t}(),_=function(){function t(){}return t.loadFromScript=function(t,e,n){var o=t.createShader(n);if(t.shaderSource(o,e.text),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS))return o;console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(o))},t.createProgram=function(t,e,n){var o=t.createProgram();return t.attachShader(o,e),t.attachShader(o,n),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(o)),t.deleteProgram(o),null)},t}(),R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(e,n,o,i){var r=t.call(this,o)||this;return r.id=e,r.name=n,r.inverseBindMatrix=i,r}return R(e,t),e}(h),L=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},M=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},U=function(){function t(){}return t.getComponentLengthByType=function(){},t.loadGltf=function(t){return L(this,void 0,void 0,(function(){function e(t,e,n){var i=e.accessors[t],r=e.bufferViews[i.bufferView],a=function(t,e,n,i){switch(i){case o.FLOAT:return new Float32Array(t,e,n/Float32Array.BYTES_PER_ELEMENT);case o.SHORT:return new Int16Array(t,e,n/Int16Array.BYTES_PER_ELEMENT);case o.UNSIGNED_BYTE:return new Uint8Array(t,e,n/Uint8Array.BYTES_PER_ELEMENT);case o.UNSIGNED_INTEGER:return new Uint32Array(t,e,n/Uint32Array.BYTES_PER_ELEMENT);case o.UNSIGNED_SHORT:return new Uint16Array(t,e,n/Uint16Array.BYTES_PER_ELEMENT);default:return console.error("ComponentType not found: ",i),null}}(n[r.buffer],r.byteOffset,r.byteLength,i.componentType);return{max:i.max,min:i.min,type:i.type,data:a}}var n,r,h,f,x,m,p=this;return M(this,(function(o){switch(o.label){case 0:return n={positionData:null,normalData:null,texCoordData:null,indicesData:null,jointData:null,weightData:null,rootJoint:null,jointCount:0,animations:[]},[4,this.loadJson(t)];case 1:return h=o.sent(),f=new URL(t,location.href),[4,Promise.all(h.buffers.map((function(t){var e=new URL(t.uri,f.href);return p.loadArrayBuffer(e.href)})))];case 2:return x=o.sent(),h.meshes.forEach((function(t){t.primitives.forEach((function(t){var o=t.attributes.POSITION,i=t.attributes.NORMAL,r=t.attributes.TEXCOORD_0,a=t.attributes.JOINTS_0,s=t.attributes.WEIGHTS_0,c=t.indices;n.positionData=e(o,h,x).data,n.normalData=e(i,h,x).data,n.texCoordData=e(r,h,x).data,n.jointData=e(a,h,x).data,n.weightData=e(s,h,x).data,n.indicesData=e(c,h,x).data}))})),h.skins.forEach((function(t){var e=t.joints.map((function(t){return h.nodes[t]})),o=h.accessors[t.inverseBindMatrices],i=h.bufferViews[o.bufferView],f=x[i.buffer];r=new Float32Array(f,i.byteOffset,i.byteLength/Float32Array.BYTES_PER_ELEMENT);for(var p=new Array(r.length/16),E=0;E<p.length;E++){var d=16*E;p[E]=new c(r[0+d],r[1+d],r[2+d],r[3+d],r[4+d],r[5+d],r[6+d],r[7+d],r[8+d],r[9+d],r[10+d],r[11+d],r[12+d],r[13+d],r[14+d],r[15+d])}for(m=new Array(e.length),E=0;E<e.length;E++){var A=new a(0,0,0),y=new s(0,0,0,1),T=new a(1,1,1);e[E].translation&&(A.x=e[E].translation[0],A.y=e[E].translation[1],A.z=e[E].translation[2]),e[E].rotation&&(y.x=e[E].rotation[0],y.y=e[E].rotation[1],y.z=e[E].rotation[2],y.w=e[E].rotation[3]),e[E].scale&&(T.x=e[E].scale[0],T.y=e[E].scale[1],T.z=e[E].scale[2]);var g=new u(y.x,y.y,y.z,y.w),w=new l(A,g,T);m[E]=new b(E,e[E].name,w,p[E])}var v=function(t){e[t].children&&e[t].children.forEach((function(e){m.find((function(t){return t.name===h.nodes[e].name})).setParent(m[t])}))};for(E=0;E<e.length;E++)v(E);n.rootJoint=m[0],n.jointCount=m.length})),h.animations.forEach((function(t,o){var r=0,a={};a.animationName=t.name?t.name:"anim"+o;var s={};t.channels.forEach((function(n,o){var a=t.samplers[n.sampler],c=e(a.input,h,x),u=e(a.output,h,x),l=h.nodes[n.target.node],f=l.name?l.name:"joint"+o;s[f]||(s[f]={jointName:f});var m=s[f],p=[];switch(c.data.forEach((function(t,e){t*=2;var n=i[u.type],o=e*n;r=Math.max(r,t),p.push({timestamp:t,values:Array.from(u.data.slice(o,o+n))})})),n.target.path.toLowerCase()){case"translation":m.translation={interpolationMethod:a.interpolation,samples:p};break;case"rotation":m.rotation={interpolationMethod:a.interpolation,samples:p};break;case"scale":m.scale={interpolationMethod:a.interpolation,samples:p};break;default:console.error("path not implemented: ",n.target.path)}})),a.jointsAnimations=Object.values(s),a.animationLength=r,n.animations.push(a)})),console.log(n.animations),[2,n]}}))}))},t.loadText=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().text()]}}))}))},t.loadJson=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().json()]}}))}))},t.loadImage=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){return[2,new Promise((function(e,n){var o=new Image;o.addEventListener("load",(function(){e(o)})),o.src=t}))]}))}))},t.loadArrayBuffer=function(t){return L(this,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().arrayBuffer()]}}))}))},t}();!function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INTEGER=5125]="UNSIGNED_INTEGER",t[t.FLOAT=5126]="FLOAT"}(o||(o={})),function(t){t[t.SCALAR=1]="SCALAR",t[t.VEC2=2]="VEC2",t[t.VEC3=3]="VEC3",t[t.VEC4=4]="VEC4",t[t.MAT2=4]="MAT2",t[t.MAT3=9]="MAT3",t[t.MAT4=16]="MAT4"}(i||(i={}));var C,D,P,S=function(){function t(e,n,o,i){this.fieldOfView=e,this.aspectRatio=n,this.near=o,this.far=i,this.transform=new l,null===t.getActiveCamera()&&t.setActiveCamera(this)}return t.prototype.computePerspectiveMatrix=function(){this.perspectiveMatrix=c.makePerspective(this.fieldOfView,this.aspectRatio,this.near,this.far)},t.prototype.getPerspectiveMatrix=function(){return this.perspectiveMatrix},t.getActiveCamera=function(){return t.activeCamera},t.setActiveCamera=function(e){t.activeCamera=e},t.activeCamera=null,t}(),z=function(){function t(t,e,n){this.activeCamera=null!=t?t:null,this.globalLightDirection=null!=e?e:null,this.rootNodes=null!=n?n:[]}return t.prototype.update=function(){this.rootNodes.forEach((function(t){t.updateTransforms()}))},t.prototype.render=function(){var t=this;this.rootNodes.forEach((function(e){var n=e;n.render&&(n.update(),n.render(t.activeCamera))}))},t}(),O=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),F=function(t){function e(e,n,o,i,r){var a=t.call(this,r)||this,s=a.renderer.getContext();return a.positions=s.createBuffer(),a.normals=s.createBuffer(),a.textureCoords=s.createBuffer(),a.indices=s.createBuffer(),a.indexCount=i.length,a.bufferData(a.indices,i,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER),a.bufferData(a.positions,e,WebGLRenderingContext.ARRAY_BUFFER),a.bufferData(a.normals,n,WebGLRenderingContext.ARRAY_BUFFER),a.bufferData(a.textureCoords,o,WebGLRenderingContext.ARRAY_BUFFER),a}return O(e,t),e.prototype.update=function(){},e}(x),B=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),G=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.positionAttributeLocation=e.getAttribLocation(n,"a_position"),o.texCoordsAttributeLocation=e.getAttribLocation(n,"a_texcoord"),o.normalsAttributeLocation=e.getAttribLocation(n,"a_normal"),o.worldMatrixUniformLocation=e.getUniformLocation(n,"u_worldMatrix"),o.viewMatrixUniformLocation=e.getUniformLocation(n,"u_viewMatrix"),o.projectionMatrixUniformLocation=e.getUniformLocation(n,"u_projectionMatrix"),o.worldInverseTransposeMatrixLocation=e.getUniformLocation(n,"u_worldInverseTransposeMatrix"),o.reverseLightDirectionLocation=e.getUniformLocation(n,"u_reverseLightDirection"),o}return B(e,t),e.prototype.loadTexture=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.generateMipmap(this.context.TEXTURE_2D),e},e.prototype.loadTexture2=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,1,1,0,this.context.RGBA,this.context.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),e},e.prototype.clear=function(){this.context.clearColor(.5,.5,.5,1),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT)},e.prototype.render=function(t,e){var n=e.getPerspectiveMatrix(),o=c.makeViewMatrix(e.transform.position,a.add(e.transform.position,e.transform.forward),a.up);this.context.viewport(0,0,this.context.canvas.width,this.context.canvas.height),this.context.useProgram(this.program),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.context.uniformMatrix4fv(this.worldMatrixUniformLocation,!1,t.transform.getWorldMatrix().flatten()),this.context.uniformMatrix4fv(this.projectionMatrixUniformLocation,!1,n.flatten()),this.context.uniformMatrix4fv(this.viewMatrixUniformLocation,!1,o.flatten());var i=c.inverse(t.transform.getWorldMatrix());this.context.uniformMatrix4fv(this.worldInverseTransposeMatrixLocation,!1,c.transpose(i).flatten());var r=a.normalize(new a(.5,.7,1));this.context.uniform3fv(this.reverseLightDirectionLocation,new Float32Array([r.x,r.y,r.z])),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.positions),this.context.enableVertexAttribArray(this.positionAttributeLocation),this.context.vertexAttribPointer(this.positionAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.textureCoords),this.context.enableVertexAttribArray(this.texCoordsAttributeLocation),this.context.vertexAttribPointer(this.texCoordsAttributeLocation,2,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.normals),this.context.enableVertexAttribArray(this.normalsAttributeLocation),this.context.vertexAttribPointer(this.normalsAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,t.texture),this.context.drawElements(WebGLRenderingContext.TRIANGLES,t.indexCount,this.context.UNSIGNED_SHORT,0)},e}(y),j={cameraObj:null,forwardVelocity:new a(0,0,0),rightVelocity:new a(0,0,0),maxXRotation:t(88),minXRotation:t(-88),currentRotationAngles:new a,cameraSpeed:20,mouseSensibility:.1,Move:function(t){var e=this.cameraObj,n=this.cameraSpeed*p.deltaTime,o=a.multiply(e.transform.forward,-t.z),i=a.multiply(e.transform.right,t.x),r=a.multiply(a.add(o,i),n);e.transform.translate(r)},Rotate:function(t){var e=this.cameraObj,n=this.mouseSensibility*p.deltaTime;new a(this.currentRotationAngles.x,this.currentRotationAngles.y,0),this.currentRotationAngles.x-=n*t.x,this.currentRotationAngles.y-=n*t.y,this.currentRotationAngles.x>this.maxXRotation?this.currentRotationAngles.x=this.maxXRotation:this.currentRotationAngles.x<this.minXRotation&&(this.currentRotationAngles.x=this.minXRotation),e.transform.setRotation(this.currentRotationAngles)}},N={up:!1,down:!1,left:!1,right:!1},I=new Array;function X(t){var e;p.computeTime(t),e=new a,N.up&&(e=a.add(e,a.forward)),N.down&&(e=a.add(e,a.backward)),N.right&&(e=a.add(e,a.right)),N.left&&(e=a.add(e,a.left)),j.Move(e),P.update(),D.clear(),P.render(),requestAnimationFrame(X)}window.onload=function(){U.loadGltf("./assets/whale.CYCLES.gltf").then((function(e){!function(){var e=document.querySelector("#canvas"),n=document.querySelector("#vertex-shader-3d-textured-lit2"),o=document.querySelector("#fragment-shader-3d-textured-lit2"),i=document.querySelector("#vertex-shader-3d-textured-skinned"),r=document.querySelector("#fragment-shader-3d-textured-skinned"),a=e.getContext("webgl");if(a){a.getExtension("OES_texture_float");var s=_.loadFromScript(a,n,a.VERTEX_SHADER),c=_.loadFromScript(a,o,a.FRAGMENT_SHADER),u=_.createProgram(a,s,c);C=new G(a,u),s=_.loadFromScript(a,i,a.VERTEX_SHADER),c=_.loadFromScript(a,r,a.FRAGMENT_SHADER),u=_.createProgram(a,s,c),D=new g(a,u);var l=e.clientWidth/e.clientHeight,h=t(60);j.cameraObj=new S(h,l,1,2e3),j.cameraObj.computePerspectiveMatrix()}else console.error("Something went wrong while creating webgl context")}(),P=new z(j.cameraObj,a.normalize(new a(.5,.7,1)),[]);var n=D.loadTexture2(new s(0,0,255,255)),o=new F(e.positionData,e.normalData,e.texCoordData,e.indicesData,C);o.transform.position=new a(3,5,0),o.transform.scale=new a(.4347,.4347,.4347),o.transform.rotate(new a(t(90),0,0)),o.texture=n,o.update=function(){};var i=new A(e.positionData,e.normalData,e.texCoordData,e.indicesData,e.jointData,e.weightData,e.rootJoint,e.jointCount,D);i.transform.rotate(new a(t(85),0,0)),i.transform.translate(new a(0,0,-10));var r=v.fromGLTFAnimation(e.animations[0]);v.fromGLTFAnimation(e.animations[1]),i.doAnimation(r),i.texture=n,I.push(i),P.rootNodes.push(i),function(){document.addEventListener("keydown",(function(t){"w"===t.key?N.up=!0:"s"===t.key?N.down=!0:"a"===t.key?N.left=!0:"d"===t.key?N.right=!0:t.key})),document.addEventListener("keyup",(function(t){"w"===t.key?N.up=!1:"s"===t.key?N.down=!1:"a"===t.key?N.left=!1:"d"===t.key?N.right=!1:t.key}));var t=D.getContext().canvas;function e(t){var e=new a(t.movementY,t.movementX,0);j.Rotate(e)}t.addEventListener("click",(function(t){this.requestPointerLock()})),document.addEventListener("pointerlockchange",(function(){document.pointerLockElement===t?document.addEventListener("mousemove",e):document.removeEventListener("mousemove",e)}))}(),requestAnimationFrame(X)}))}})();
//# sourceMappingURL=main.js.map